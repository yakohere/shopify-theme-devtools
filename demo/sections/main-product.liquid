<section class="product-page" id="shopify-section-{{ section.id }}" data-section-type="main-product" {{ section.shopify_attributes }}>
  <div class="product-page__inner">
    {%- if product -%}
      <div class="product-page__gallery">
        {%- if product.featured_image -%}
          <img 
            src="{{ product.featured_image | image_url: width: 800 }}" 
            alt="{{ product.featured_image.alt | escape | default: product.title }}"
            width="800"
            height="800"
          >
        {%- else -%}
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}
      </div>

      <div class="product-page__info">
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'vendor' -%}
              {%- if product.vendor != blank -%}
                <p class="product-page__vendor" {{ block.shopify_attributes }}>{{ product.vendor }}</p>
              {%- endif -%}

            {%- when 'title' -%}
              <h1 class="product-page__title" {{ block.shopify_attributes }}>{{ product.title }}</h1>

            {%- when 'price' -%}
              <div class="product-page__price" {{ block.shopify_attributes }}>
                {%- if product.compare_at_price > product.price -%}
                  <span class="product-page__price-sale">{{ product.price | money }}</span>
                  <span class="product-page__price-compare">{{ product.compare_at_price | money }}</span>
                {%- else -%}
                  {{ product.price | money }}
                {%- endif -%}
              </div>

            {%- when 'description' -%}
              {%- if product.description != blank -%}
                <div class="product-page__description" {{ block.shopify_attributes }}>
                  {{ product.description }}
                </div>
              {%- endif -%}

            {%- when 'variant_picker' -%}
              {%- unless product.has_only_default_variant -%}
                <div class="product-form__options" {{ block.shopify_attributes }}>
                  {%- for option in product.options_with_values -%}
                    <div class="product-form__option">
                      <label for="option-{{ option.name | handleize }}">{{ option.name }}</label>
                      <select id="option-{{ option.name | handleize }}" name="options[{{ option.name }}]">
                        {%- for value in option.values -%}
                          <option value="{{ value }}" {% if option.selected_value == value %}selected{% endif %}>
                            {{ value }}
                          </option>
                        {%- endfor -%}
                      </select>
                    </div>
                  {%- endfor -%}
                </div>
              {%- endunless -%}

            {%- when 'buy_button' -%}
              <form action="{{ routes.cart_add_url }}" method="post" class="product-form" {{ block.shopify_attributes }}>
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                
                {%- if block.settings.show_quantity -%}
                  <div class="product-form__quantity">
                    <label for="quantity">Quantity</label>
                    <input type="number" id="quantity" name="quantity" value="1" min="1">
                  </div>
                {%- endif -%}
                
                <button 
                  type="submit" 
                  class="btn btn-primary product-form__submit"
                  {% unless product.available %}disabled{% endunless %}
                >
                  {%- if product.available -%}
                    Add to Cart â€” {{ product.price | money }}
                  {%- else -%}
                    Sold Out
                  {%- endif -%}
                </button>

                {%- if block.settings.show_dynamic_checkout and product.available -%}
                  <div class="product-form__dynamic-checkout">
                    {{ form | payment_button }}
                  </div>
                {%- endif -%}
              </form>

          {%- endcase -%}
        {%- endfor -%}

        {%- if product.metafields.custom.size > 0 -%}
          <div class="product-page__metafields">
            {%- for metafield in product.metafields.custom -%}
              <p>
                <strong>{{ metafield.first | handleize | replace: '-', ' ' | capitalize }}:</strong> 
                {{ metafield.last }}
              </p>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>
    {%- else -%}
      <div class="product-page__empty">
        <p>Product not found</p>
        <a href="{{ routes.all_products_collection_url }}" class="btn btn-primary">Browse Products</a>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Product",
  "tag": "section",
  "class": "section-main-product",
  "blocks": [
    {
      "type": "vendor",
      "name": "Vendor",
      "limit": 1
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "Variant Picker",
      "limit": 1
    },
    {
      "type": "buy_button",
      "name": "Buy Button",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_quantity",
          "label": "Show quantity selector",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show dynamic checkout buttons",
          "default": false
        }
      ]
    }
  ]
}
{% endschema %}
